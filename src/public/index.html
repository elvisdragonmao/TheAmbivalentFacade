<!doctype html>
<html lang="zh-Hant-TW">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Invitation</title>
  <link rel="stylesheet" href="/index.css" />
  <script src="https://cdn.jsdelivr.net/npm/fullpage.js@4.0.40/dist/fullpage.min.js"
    integrity="sha256-+b6hSscfWxftVyeB3vQMUog2PSdfOARBfO4I6sEX8ic=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullpage.js@4.0.40/dist/fullpage.min.css"
    integrity="sha256-5aXR+4+VYo1tk8eyP36qkRTOaVT6ClB1byMg6tSQ3Vc=" crossorigin="anonymous" />
</head>

<body>
  <!-- Loading Screen -->
  <div id="loading" class="loading">
    <div class="loader"></div>
    <p>Loading...</p>
  </div>

  <!-- Main Content -->
  <main style="display: none">
    <div id="fullpage">
      <!-- Invitation Content (shown when invited) -->
      <div class="section" id="invitationContent" style="display: none">
        <div class="welcome-text">You're Invited!</div>
        <div class="invitation-details">
          <h2 id="guestName"></h2>
          <div id="message" class="message"></div>
        </div>
      </div>
      <div class="section">
        <h1>Welcome</h1>
      </div>
      <div class="section">Some section</div>
      <div class="section">Some section</div>
      <div class="section">Some section</div>
    </div>
  </main>

  <script>
    // Get invite parameter from URL
    const urlParams = new URLSearchParams(window.location.search);
    const inviteSlug = urlParams.get("invite");

    const loadInvitation = async () => {
      const loading = document.getElementById("loading");
      const content = document.querySelector("main");

      if (!inviteSlug) {
        // No invite slug, show default content
        loading.style.display = "none";
        content.style.display = "block";
        return;
      }

      try {
        const response = await fetch(`/api/invitation/${inviteSlug}`);

        if (response.ok) {
          const invitation = await response.json();

          // Update page title
          document.title = `Invitation for ${invitation.name}`;

          // Show invitation content
          document.getElementById("guestName").textContent = `Dear ${invitation.name} (${invitation.pronoun})`;
          document.getElementById("message").textContent = invitation.message;
          document.getElementById("invitationContent").style.display = "block";
          // document.getElementById('defaultContent').style.display = 'none';
        } else {
          // Invitation not found, show default
          console.log("Invitation not found");
        }
      } catch (error) {
        console.error("Error loading invitation:", error);
      } finally {
        loading.style.display = "none";
        content.style.display = "block";
      }
    };

    const init = async () => {
      await loadInvitation();
      new fullpage("#fullpage", {
        //options here
        autoScrolling: true,
        scrollHorizontally: true
      });
    };

    window.onload = init;
  </script>
</body>

</html>